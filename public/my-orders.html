<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø·Ù„Ø¨Ø§ØªÙŠ - Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="logo">ğŸ“ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©</div>
            <ul class="nav-links">
                <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="my-orders.html">Ø·Ù„Ø¨Ø§ØªÙŠ</a></li>
                <li><a href="admin-panel.html">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <div class="fade-in">
            <h2 class="text-center">ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ</h2>
            <p class="text-center text-secondary mb-lg">ØªØ§Ø¨Ø¹ Ø­Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø§ØªÙƒ Ù…Ù† Ù‡Ù†Ø§</p>

            <!-- Email Input -->
            <div class="form-container" style="max-width: 500px;">
                <div class="form-group">
                    <label for="emailInput">Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§ØªÙƒ</label>
                    <input type="email" id="emailInput" placeholder="example@email.com">
                </div>
                <button onclick="loadOrders()" class="btn btn-primary" style="width: 100%;">Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
            </div>

            <!-- Orders Display -->
            <div id="ordersContainer" class="mt-lg"></div>
        </div>
    </main>

    <script src="app.js"></script>
    <script>
        const serviceNames = {
            'research': 'ğŸ“š Ø¨Ø­Ø« Ø¹Ù„Ù…ÙŠ',
            'presentation': 'ğŸ“Š Ø¹Ø±Ø¶ ØªÙ‚Ø¯ÙŠÙ…ÙŠ',
            'programming': 'ğŸ’» Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù…Ø¬ÙŠ',
            'software': 'ğŸ–¥ï¸ ØªØ·ÙˆÙŠØ± Ø¨Ø±Ù…Ø¬ÙŠØ§Øª',
            'custom': 'âœ¨ Ø·Ù„Ø¨ Ø®Ø§Øµ'
        };

        const statusNames = {
            'pending': 'Ø¬Ø¯ÙŠØ¯ - Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
            'in_progress': 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡',
            'completed': 'Ù…ÙƒØªÙ…Ù„'
        };

        // Check URL for email parameter
        const urlParams = new URLSearchParams(window.location.search);
        const emailFromUrl = urlParams.get('email');
        if (emailFromUrl) {
            document.getElementById('emailInput').value = emailFromUrl;
            loadOrders();
        }

        async function loadOrders() {
            const email = document.getElementById('emailInput').value.trim();
            
            if (!email) {
                alert('âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
                return;
            }

            const container = document.getElementById('ordersContainer');
            container.innerHTML = '<div class="spinner"></div>';

            try {
                const response = await fetch(API_BASE + `/api/orders/customer/${encodeURIComponent(email)}`);
                const result = await response.json();

                if (result.success) {
                    displayOrders(result.orders);
                } else {
                    container.innerHTML = `<p class="text-center text-secondary">âŒ ${result.error}</p>`;
                }
            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = '<p class="text-center text-secondary">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>';
            }
        }

        function displayOrders(orders) {
            const container = document.getElementById('ordersContainer');

            if (orders.length === 0) {
                container.innerHTML = '<p class="text-center text-secondary">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>';
                return;
            }

            let html = '<div class="orders-grid">';
            
            orders.forEach(order => {
                const serviceName = serviceNames[order.service_type] || order.service_type;
                const statusName = statusNames[order.status] || order.status;
                const createdDate = new Date(order.created_at).toLocaleDateString('ar-EG');
                
                html += `
                    <div class="order-card fade-in">
                        <div class="order-header">
                            <div>
                                <h3>${serviceName}</h3>
                                <span class="order-id">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: #${order.id}</span>
                            </div>
                            <span class="status-badge status-${order.status}">${statusName}</span>
                        </div>
                        <div class="order-details">
                            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</strong> ${createdDate}</p>
                            ${order.delivery_date ? `<p><strong>ğŸ“… Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…:</strong> ${new Date(order.delivery_date).toLocaleDateString('ar-EG')}</p>` : ''}
                            ${getOrderDetailsHTML(order)}
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function getOrderDetailsHTML(order) {
            const details = order.details;
            let html = '<div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--bg-card);">';

            switch(order.service_type) {
                case 'research':
                    html += `
                        <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${details.title}</p>
                        <p><strong>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</strong> ${details.subject}</p>
                        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª:</strong> ${details.pages}</p>
                        <p><strong>Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØ«ÙŠÙ‚:</strong> ${details.citationStyle}</p>
                    `;
                    break;
                case 'presentation':
                    html += `
                        <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${details.title}</p>
                        <p><strong>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</strong> ${details.topic}</p>
                        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­:</strong> ${details.slides}</p>
                        <p><strong>Ø§Ù„Ù†Ù…Ø·:</strong> ${details.style}</p>
                    `;
                    break;
                case 'programming':
                    html += `
                        <p><strong>Ù„ØºØ© Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©:</strong> ${details.language}</p>
                        <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</strong> ${details.projectType}</p>
                        <p><strong>Ø§Ù„ÙˆØµÙ:</strong> ${details.description.substring(0, 100)}...</p>
                    `;
                    break;
                case 'software':
                    html += `
                        <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:</strong> ${details.softwareType}</p>
                        <p><strong>Ø§Ù„Ù…Ù†ØµØ©:</strong> ${details.platform}</p>
                        <p><strong>Ø§Ù„ÙˆØµÙ:</strong> ${details.description.substring(0, 100)}...</p>
                    `;
                    break;
                case 'custom':
                    html += `
                        <p><strong>Ø§Ù„ÙˆØµÙ:</strong> ${details.requestDescription.substring(0, 150)}...</p>
                    `;
                    break;
            }

            html += '</div>';
            return html;
        }
    </script>
</body>
</html>
