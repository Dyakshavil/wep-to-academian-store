<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="logo">ğŸ“ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</div>
            <ul class="nav-links">
                <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="#" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <!-- Login Form -->
        <div id="loginSection" class="form-container fade-in" style="max-width: 500px;">
            <h2 class="text-center">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Ø¯Ø®ÙˆÙ„</button>
            </form>
            <p class="text-center text-secondary mt-lg" style="font-size: 0.875rem;">
                Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: admin / admin123
            </p>
        </div>

        <!-- Admin Dashboard -->
        <div id="dashboardSection" style="display: none;">
            <!-- Statistics -->
            <div class="fade-in">
                <h2 class="text-center mb-lg">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                <div class="stats-grid" id="statsContainer">
                    <div class="stat-card">
                        <div class="stat-value" id="totalOrders">0</div>
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pendingOrders">0</div>
                        <div class="stat-label">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="inProgressOrders">0</div>
                        <div class="stat-label">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedOrders">0</div>
                        <div class="stat-label">Ù…ÙƒØªÙ…Ù„Ø©</div>
                    </div>
                </div>
            </div>

            <!-- Orders Management -->
            <div class="mt-lg">
                <h2 class="text-center mb-lg">ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                <div id="ordersContainer"></div>
            </div>
        </div>
    </main>

    <script src="app.js"></script>
    <script>
        const serviceNames = {
            'research': 'ğŸ“š Ø¨Ø­Ø« Ø¹Ù„Ù…ÙŠ',
            'presentation': 'ğŸ“Š Ø¹Ø±Ø¶ ØªÙ‚Ø¯ÙŠÙ…ÙŠ',
            'programming': 'ğŸ’» Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù…Ø¬ÙŠ',
            'software': 'ğŸ–¥ï¸ ØªØ·ÙˆÙŠØ± Ø¨Ø±Ù…Ø¬ÙŠØ§Øª',
            'custom': 'âœ¨ Ø·Ù„Ø¨ Ø®Ø§Øµ'
        };

        // Check if already logged in
        if (localStorage.getItem('adminLoggedIn') === 'true') {
            showDashboard();
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch(API_BASE + '/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const result = await response.json();

                if (result.success) {
                    localStorage.setItem('adminLoggedIn', 'true');
                    showDashboard();
                } else {
                    alert('âŒ ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
            }
        });

        function logout() {
            localStorage.removeItem('adminLoggedIn');
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('dashboardSection').style.display = 'none';
        }

        async function showDashboard() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'block';
            
            await loadStats();
            await loadAllOrders();
        }

        async function loadStats() {
            try {
                const response = await fetch(API_BASE + '/api/admin/stats');
                const result = await response.json();

                if (result.success) {
                    const stats = result.stats;
                    document.getElementById('totalOrders').textContent = stats.total || 0;
                    document.getElementById('pendingOrders').textContent = stats.pending || 0;
                    document.getElementById('inProgressOrders').textContent = stats.in_progress || 0;
                    document.getElementById('completedOrders').textContent = stats.completed || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadAllOrders() {
            const container = document.getElementById('ordersContainer');
            container.innerHTML = '<div class="spinner"></div>';

            try {
                const response = await fetch(API_BASE + '/api/orders');
                const result = await response.json();

                if (result.success) {
                    displayOrders(result.orders);
                } else {
                    container.innerHTML = '<p class="text-center text-secondary">âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>';
                }
            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = '<p class="text-center text-secondary">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>';
            }
        }

        function displayOrders(orders) {
            const container = document.getElementById('ordersContainer');

            if (orders.length === 0) {
                container.innerHTML = '<p class="text-center text-secondary">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>';
                return;
            }

            let html = '<div class="orders-grid">';
            
            orders.forEach(order => {
                const serviceName = serviceNames[order.service_type] || order.service_type;
                const createdDate = new Date(order.created_at).toLocaleDateString('ar-EG');
                
                html += `
                    <div class="order-card fade-in">
                        <div class="order-header">
                            <div>
                                <h3>${serviceName}</h3>
                                <span class="order-id">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: #${order.id}</span>
                            </div>
                            <span class="status-badge status-${order.status}">${getStatusName(order.status)}</span>
                        </div>
                        <div class="order-details">
                            <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${order.customer_name}</p>
                            <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${order.customer_email}</p>
                            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</strong> ${createdDate}</p>
                            ${order.delivery_date ? `<p><strong>ğŸ“… Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…:</strong> ${new Date(order.delivery_date).toLocaleDateString('ar-EG')}</p>` : ''}
                            
                            <div style="margin-top: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                                <select id="status-${order.id}" class="form-group" style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem;">
                                    <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Ø¬Ø¯ÙŠØ¯ - Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                                    <option value="in_progress" ${order.status === 'in_progress' ? 'selected' : ''}>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡</option>
                                    <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>Ù…ÙƒØªÙ…Ù„</option>
                                </select>
                                
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…:</label>
                                <input type="date" id="delivery-${order.id}" value="${order.delivery_date || ''}" 
                                       style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem;">
                                
                                <button onclick="updateOrder(${order.id})" class="btn btn-success" style="width: 100%;">
                                    Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                                </button>
                            </div>
                            
                            <details style="margin-top: 1rem;">
                                <summary style="cursor: pointer; font-weight: 600; color: var(--primary-light);">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©</summary>
                                <div style="margin-top: 0.5rem; padding: 0.5rem; background: var(--bg-primary); border-radius: 0.5rem;">
                                    <pre style="white-space: pre-wrap; font-size: 0.875rem;">${JSON.stringify(order.details, null, 2)}</pre>
                                </div>
                            </details>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function getStatusName(status) {
            const names = {
                'pending': 'Ø¬Ø¯ÙŠØ¯ - Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
                'in_progress': 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡',
                'completed': 'Ù…ÙƒØªÙ…Ù„'
            };
            return names[status] || status;
        }

        async function updateOrder(orderId) {
            const status = document.getElementById(`status-${orderId}`).value;
            const deliveryDate = document.getElementById(`delivery-${orderId}`).value;

            try {
                const response = await fetch(API_BASE + `/api/orders/${orderId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status, delivery_date: deliveryDate || null })
                });

                const result = await response.json();

                if (result.success) {
                    alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                    await loadStats();
                    await loadAllOrders();
                } else {
                    alert('âŒ ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨');
            }
        }
    </script>
</body>
</html>
